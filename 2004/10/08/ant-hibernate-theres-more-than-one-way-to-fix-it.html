<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/theme.js"></script>
<link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/css/theme.css" rel="stylesheet" type="text/css">
<link href="/css/syntax.css" rel="stylesheet" type="text/css">



    <title>Third Bit: Ant + Hibernate: There's More Than One Way to Fix It</title>
  </head>
  <body>
    <div class="container-fluid">
  <div class="row-fluid">
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Third Bit</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class="active visible-xs-block"><a href="/links/">Links</a></li>
          <li class="active"><a href="/about/">About</a></li>
          <li class="active"><a href="/talks/">Talks</a></li>
          <li class="active"><a href="/ideas/">Ideas</a></li>
          <li class="active"><a href="/reading/">Reading</a></li>
          <li class="active"><a href="/archive/">Archive</a></li>
          <li class="active"><a href="/teaching/"><em>How to Teach</em></a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li class="active"><a href="http://appear.in/gvwilson"><img src="/files/appear.in.svg" class="navbar-icon" /></a></li>
          <li class="active"><a href="https://github.com/gvwilson"><img src="/files/github.svg" class="navbar-icon" /></a></li>
          <li class="active"><a href="http://twitter.com/gvwilson"><img src="/files/twitter.svg" class="navbar-icon" /></a></li>
          <li class="active"><a href="/feed.xml"><img src="/files/rss.svg" class="navbar-icon" /></a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <div class="container container-left">
      <div class="row">
        <div class="col-md-3 hidden-xs">
          <div class="sidebar well">
  <h2>Links</h2>
<p><em><a href="http://software-carpentry.org">Software Carpentry</a></em></p>
<p><em><a href="http://aosabook.org">Architecture of Open Source Applications</a></em></p>
<p><em><a href="http://neverworkintheory.org">Never Work in Theory</a></em></p>
<p><em><a href="http://sensibleadventures.com">Sensible Adventures</a></em></p>
<p><a href="/cv/">CV</a></p>
<p><a href="/bib/">Bibliography</a></p>

  <h2>Favorites</h2>
  
  
  <p><a href="/2018/03/20/goodbye-jeff.html">Goodbye, Jeff</a></p>
  
  <p><a href="/2018/03/16/seven-ways.html">Seven Ways to Think Like a Programmer</a></p>
  
  <p><a href="/2018/03/13/base-case-for-empirical-software-engineering.html">A Base Case for Empirical Software Engineering Research</a></p>
  
  <p><a href="/2018/01/07/book-club.html">Book Club</a></p>
  
  <p><a href="/2017/12/21/talking-people-into-things.html">Ten Simple Rules for Talking People Into Things</a></p>
  
  <p><a href="/2017/11/05/for-everyone.html">Carpentry For Everyone</a></p>
  
  <p><a href="/2017/10/16/exercise-types.html">What Kinds of Exercises Do You Use to Teach Programming?</a></p>
  
  <p><a href="/2017/09/30/git-graphs-and-engineering.html">Git, Graphs, and Software Engineering</a></p>
  
  <p><a href="/2017/06/19/ten-rules-research-partner.html">Ten Simple Rules for Being a Good Research Partner</a></p>
  
  <p><a href="/2017/05/22/numerical-javascript.html">Numerical JavaScript</a></p>
  
  <p><a href="/2017/01/06/them-thats-got.html">Them That's Got</a></p>
  
  <p><a href="/2016/10/30/rules-for-teaching.html">Rules for Teaching</a></p>
  
  <p><a href="/2016/04/29/why-teachers-dont-collaborate.html">Why Teachers Don't Collaborate on Lesson Development</a></p>
  
  <p><a href="/2016/04/01/zen-and-the-art-of-assignment-operators.html">Zen and the Art of Assignment Operators</a></p>
  
  <p><a href="/2016/03/13/in-my-better-world.html">In My Better World</a></p>
  
  <p><a href="/2015/12/19/why-i-teach.html">Why I Teach (Revisited)</a></p>
  
  <p><a href="/2015/12/06/just-keep-swimming.html">Just Keep Swimming</a></p>
  
  <p><a href="/2015/11/29/exaptation.html">Exaptation and the Future of Software Engineering</a></p>
  
  <p><a href="/2015/11/09/daddy-why-dont-you-ever-laugh.html">Daddy, Why Don't You Ever Laugh?</a></p>
  
  <p><a href="/2015/09/22/dad.html">Goodbye, Dad</a></p>
  
  <p><a href="/2014/10/08/announcing-the-creation-of-the-software-carpentry-foundational.html">Announcing the Creation of the Software Carpentry Foundation</a></p>
  
  <p><a href="/2014/03/14/learning-at-scale.html">Is Learning at Scale Just Another Name for Ubiquitous Surveillance in the Classroom?</a></p>
  
  <p><a href="/2013/10/17/you-keep-using-that-word.html">You Keep Using That Word</a></p>
  
  <p><a href="/2013/02/11/correctness-isnt-compelling.html">Correctness Isn't Compelling</a></p>
  
  <p><a href="/2012/10/23/twenty-percent.html">Twenty Percent</a></p>
  
  <p><a href="/2012/06/29/those-who-ignore-history.html">That Seems Simple to Me</a></p>
  
  <p><a href="/2012/01/21/the-life-i-did-live-the-breath-i-breathed.html">We Have Nothing To Give Them</a></p>
  
</div>

        </div>
        <div class="col-md-9">
          <div class="article">
            <div class="well">
              <h1><a href="/2004/10/08/ant-hibernate-theres-more-than-one-way-to-fix-it.html">Oct 8, 2004 - Ant + Hibernate: There's More Than One Way to Fix It</a></h1>
              <div class="post-content">
                <p>I don't know who William Lopez is---I've never met the man, and before yesterday at 19:40 EST, I'd never heard of him.  But then a mail message landed in my inbox saying, "I think I've solved your <a href="http://pyre.third-bit.com/blog/archives/000110.html">Ant + Hibernate problem</a>."  He included his solution in a ZIP file; it took me all of five minutes to download it, edit a couple of settings for my machine (library files in different places), and convince myself that yes, it did work.  It took another ten minutes to figure out which of his changes was the crucial one, and guess what: it's an Ant bug.</p>

<p>Or maybe not, because three hours later, Eric Burke added a comment to the <a href="http://pyre.third-bit.com/blog/archives/000110.html">original posting</a>.  His solution was to rearrange some of the Hibernate-specific stuff in the build file.  So who's fault is it really, Ant's or Hibernate's?  Let's take a look.</p>

<p>I was trying to get Ant to clean my workspace, generate a Java source file from a Hibernate mapping file, compile that file and another one I'd written by hand, and then generate a database schema, all in one invocation. The <a href="http://pyre.third-bit.com/blog/archives/000110.html">problem</a> was that when I got to the schema generation step, the Hibernate schema generation task told me that the compiled class file for the generated class didn't exist.  If I ran Ant twice, though, everything worked; it also all worked if I ran Ant as far as "compile the Java", then ran it again to do the schema generation.  But how could there be a timing bug in a strictly sequential chain of operations?</p>

<p>William Lopez's solution was to create all of the temporary directories the build process needed once, at the start of the build process, rather than creating each directory just before it was needed.  Basically, I had:</p>

<blockquote><pre>
&lt;target name="clean"&gt;
    &lt;delete dir="${gen}"/&gt;
    &lt;delete dir="${class}"/&gt;
    &lt;delete dir="${data}"/&gt;
&lt;/target&gt;

&lt;target name="codegen"&gt;
    <b>&lt;mkdir dir="${gen}"/&gt;</b>
    &lt;hbm2java output="${gen}"&gt; /&gt;
&lt;/target&gt;

&lt;target name="compile" depends="codegen"&gt;
    <b>&lt;mkdir dir="${class}"/&gt;</b>
    &lt;javac srcdir="${gen}" destdir="${class}" ...&gt; /&gt;
    &lt;javac srcdir="${src}" destdir="${class}" ...&gt; /&gt;
&lt;/target&gt;

&lt;target name="schema" depends="compile"&gt;
    <b>&lt;mkdir dir="${data}"/&gt;</b>
    &lt;schemaexport ... /&gt;
&lt;/target&gt;
</pre></blockquote>

<p>and William changed it by moving the <code>mkdir</code> actions inside the <code>clean</code> target:</p>

<blockquote><pre>
&lt;target name="clean"&gt;
    &lt;delete dir="${gen}"/&gt;
    &lt;delete dir="${class}"/&gt;
    &lt;delete dir="${data}"/&gt;
    <b>&lt;mkdir dir="${gen}"/&gt;</b>
    <b>&lt;mkdir dir="${class}"/&gt;</b>
    <b>&lt;mkdir dir="${data}"/&gt;</b>
&lt;/target&gt;

&lt;target name="codegen"&gt;
    &lt;hbm2java output="${gen}"&gt; /&gt;
&lt;/target&gt;

&lt;target name="compile" depends="codegen"&gt;
    &lt;javac srcdir="${gen}" destdir="${class}" ...&gt; /&gt;
    &lt;javac srcdir="${src}" destdir="${class}" ...&gt; /&gt;
&lt;/target&gt;

&lt;target name="schema" depends="compile"&gt;
    &lt;schemaexport ... /&gt;
&lt;/target&gt;
</pre></blockquote>

<p>So it has to be an Ant problem---except that Eric Burke <a href="http://www.ericburke.com/blog/2004/10/solution-to-gregs-hibernate-problem.html">fixed the problem</a> by moving the schema export <code>taskdef</code> <em>inside</em> the schema export target, like this:</p>

<blockquote><pre>
&lt;target name="schema" depends="compile"&gt;

    &lt;taskdef name="schemaexport"
             classname="net.sf.hibernate.tool.hbm2ddl.SchemaExportTask"
             classpathref="cpath.compile" /&gt;

    &lt;mkdir dir="${data}"/&gt;

    &lt;schemaexport .../&gt;

&lt;/target&gt;
</pre></blockquote>

<p>and that works too.  <a href="http://www.ericburke.com/blog/2004/10/solution-to-gregs-hibernate-problem.html">His explanation</a> says:</p>

<blockquote>
I suspect the taskdef is resolving the classpath at the instant Ant parses the taskdef tag. Since one of the required .class files has not been generated yet, the SchemaExportTask does not find the necessary files...
While you could blame Ant, I think it's more likely that the SchemaExportTask should probably be modified to accept a classpath of its own. This would make the task more flexible since you wouldn't have to worry about where you define it.
</blockquote>

<p>He then goes on to say:</p>

<blockquote>
I hope someone finds this useful. [Yes, Eric, very; thank you, and thanks to William, too.]  There is still a very steep barrier to entry for tools like Hibernate, various AOP frameworks, etc... The barrier is figuring out all of the initial configuration options and getting your build process to flow. These things are overwhelming when you are first getting started.
</blockquote>

<p>Amen, Eric.  Eleven of <a href="http://www.cs.utoronto.ca">my department</a>'s brightest undergraduates have been banging their heads against Eclipse, Ant, JUnit, Tomcat, Hibernate, Tapestry, and Checkstyle for more than four weeks now.  They're smart, they work very hard, and they really want to master this stuff, but the learning "curve" they face is more like a vertical wall.  If the open source community wants colleges and universities to include modern tools and frameworks in the curriculum, they're going to have to do a better job fixing the "last 10%" of problems that so often gobble up all the hours students are supposed to spend learning...</p>

                


              </div>
            </div>
            <div class="pagination">
              
              <a class="btn btn-default" href="/2004/10/08/open-source-cold-shoulder.html" class="next">Newer</a>
              
              
              <a class="btn btn-default" href="/2004/10/08/ant-eclipse-more-pain.html" class="previous">Older</a>
              
            </div>
            
            
            <div class="well">
              
              <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
              </div>
              
            </div>
            
            
          </div>
        </div>
      </div>
    </div>
    
  <script type="text/javascript">
    var disqus_shortname = 'thirdbit';

    var disqus_config = function () {
        this.page.identifier = '2004-10-08-ant-hibernate-theres-more-than-one-way-to-fix-it-html';
    };

   (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


    <div class="container-fluid">
  <div class="row-fluid">
    <div class="span12 footer navbar-inverse navbar-fixed-bottom">
      <br/>
      <p class="copyright">
        &copy; 2018 Greg Wilson.
        All content made available under the <a href="/license/">Creative Commons - Attribution License</a>.
      </p>
    </div>
  </div>
</div>


  <script type="text/javascript">
    var disqus_shortname = 'thirdbit';

    var disqus_config = function () {
        this.page.identifier = '2004-10-08-ant-hibernate-theres-more-than-one-way-to-fix-it-html';
    };

   (function () {
     var s = document.createElement('script'); s.async = true;
     s.type = 'text/javascript';
     s.src = '//' + disqus_shortname + '.disqus.com/count.js';
     (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
   }());
 </script>



  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1301159-1', 'auto');
    ga('send', 'pageview');
  </script>



</body>
</html>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/theme.js"></script>
<link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/css/theme.css" rel="stylesheet" type="text/css">
<link href="/css/syntax.css" rel="stylesheet" type="text/css">



    <title>Third Bit: Why Does Flask Lose My Post Data When It Redirects?</title>
  </head>
  <body>
    <div class="container-fluid">
  <div class="row-fluid">
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Third Bit</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class="active visible-xs-block"><a href="/links/">Links</a></li>
          <li class="active"><a href="/about/">About</a></li>
          <li class="active"><a href="/talks/">Talks</a></li>
          <li class="active"><a href="/ideas/">Ideas</a></li>
          <li class="active"><a href="/reading/">Reading</a></li>
          <li class="active"><a href="/archive/">Archive</a></li>
          <li class="active"><a href="/teaching/"><em>How to Teach</em></a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li class="active"><a href="http://appear.in/gvwilson"><img src="/files/appear.in.svg" class="navbar-icon" /></a></li>
          <li class="active"><a href="https://github.com/gvwilson"><img src="/files/github.svg" class="navbar-icon" /></a></li>
          <li class="active"><a href="http://twitter.com/gvwilson"><img src="/files/twitter.svg" class="navbar-icon" /></a></li>
          <li class="active"><a href="/feed.xml"><img src="/files/rss.svg" class="navbar-icon" /></a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <div class="container container-left">
      <div class="row">
        <div class="col-md-3 hidden-xs">
          <div class="sidebar well">
  <h2>Links</h2>
<p><em><a href="http://software-carpentry.org">Software Carpentry</a></em></p>
<p><em><a href="http://aosabook.org">Architecture of Open Source Applications</a></em></p>
<p><em><a href="http://neverworkintheory.org">Never Work in Theory</a></em></p>
<p><em><a href="http://sensibleadventures.com">Sensible Adventures</a></em></p>
<p><a href="/cv/">CV</a></p>
<p><a href="/bib/">Bibliography</a></p>

  <h2>Favorites</h2>
  
  
  <p><a href="/2018/03/20/goodbye-jeff.html">Goodbye, Jeff</a></p>
  
  <p><a href="/2018/03/16/seven-ways.html">Seven Ways to Think Like a Programmer</a></p>
  
  <p><a href="/2018/03/13/base-case-for-empirical-software-engineering.html">A Base Case for Empirical Software Engineering Research</a></p>
  
  <p><a href="/2018/01/07/book-club.html">Book Club</a></p>
  
  <p><a href="/2017/12/21/talking-people-into-things.html">Ten Simple Rules for Talking People Into Things</a></p>
  
  <p><a href="/2017/11/05/for-everyone.html">Carpentry For Everyone</a></p>
  
  <p><a href="/2017/10/16/exercise-types.html">What Kinds of Exercises Do You Use to Teach Programming?</a></p>
  
  <p><a href="/2017/09/30/git-graphs-and-engineering.html">Git, Graphs, and Software Engineering</a></p>
  
  <p><a href="/2017/06/19/ten-rules-research-partner.html">Ten Simple Rules for Being a Good Research Partner</a></p>
  
  <p><a href="/2017/05/22/numerical-javascript.html">Numerical JavaScript</a></p>
  
  <p><a href="/2017/01/06/them-thats-got.html">Them That's Got</a></p>
  
  <p><a href="/2016/10/30/rules-for-teaching.html">Rules for Teaching</a></p>
  
  <p><a href="/2016/04/29/why-teachers-dont-collaborate.html">Why Teachers Don't Collaborate on Lesson Development</a></p>
  
  <p><a href="/2016/04/01/zen-and-the-art-of-assignment-operators.html">Zen and the Art of Assignment Operators</a></p>
  
  <p><a href="/2016/03/13/in-my-better-world.html">In My Better World</a></p>
  
  <p><a href="/2015/12/19/why-i-teach.html">Why I Teach (Revisited)</a></p>
  
  <p><a href="/2015/12/06/just-keep-swimming.html">Just Keep Swimming</a></p>
  
  <p><a href="/2015/11/29/exaptation.html">Exaptation and the Future of Software Engineering</a></p>
  
  <p><a href="/2015/11/09/daddy-why-dont-you-ever-laugh.html">Daddy, Why Don't You Ever Laugh?</a></p>
  
  <p><a href="/2015/09/22/dad.html">Goodbye, Dad</a></p>
  
  <p><a href="/2014/10/08/announcing-the-creation-of-the-software-carpentry-foundational.html">Announcing the Creation of the Software Carpentry Foundation</a></p>
  
  <p><a href="/2014/03/14/learning-at-scale.html">Is Learning at Scale Just Another Name for Ubiquitous Surveillance in the Classroom?</a></p>
  
  <p><a href="/2013/10/17/you-keep-using-that-word.html">You Keep Using That Word</a></p>
  
  <p><a href="/2013/02/11/correctness-isnt-compelling.html">Correctness Isn't Compelling</a></p>
  
  <p><a href="/2012/10/23/twenty-percent.html">Twenty Percent</a></p>
  
  <p><a href="/2012/06/29/those-who-ignore-history.html">That Seems Simple to Me</a></p>
  
  <p><a href="/2012/01/21/the-life-i-did-live-the-breath-i-breathed.html">We Have Nothing To Give Them</a></p>
  
</div>

        </div>
        <div class="col-md-9">
          <div class="article">
            <div class="well">
              <h1><a href="/2011/05/21/why-does-flask-lose-my-post-data-when-it-redirects.html">May 21, 2011 - Why Does Flask Lose My Post Data When It Redirects?</a></h1>
              <div class="post-content">
                I'm trying to decide which Python web programming framework to use in the Software Carpentry course. Simplicity is the main criterion: in fact, other than "still a live project", it's the <em>only</em> criterion. Flask is a strong contender despite the fact that its documentation is written for people who already understand web programming&mdash;I can fill that in.  What I'm struggling with now, though, is that the same "hide the details" approach that makes it approachable is also making debugging difficult.

For example, here's a simple application:
<pre>from flask import Flask, render_template, request
DEBUGGING = True
app = Flask(__name__)

def load_data():
    return [
        [True, "luke", "2011-05-03", "luke", "Figure this out"],
        [True, "luke", "2011-05-03", "yele", "Figure this out"],
        [False, "luke", "2011-05-03", "gvwilson", "Figure this out"]
    ]

@app.route('/show/', methods=['POST', 'GET'])
def show():
    data = load_data()
    try:
        items = request.form['item']
        count = str(len(items))
    except KeyError:
        count = "no items"
    return render_template('show.html', data=data, count=count)

if __name__ == '__main__':
    app.run(debug=DEBUGGING)</pre>
which I put in <code>show.py</code>.  Here's the corresponding template, which I put in <code>templates/show.html</code>:
<pre>&lt;html&gt;
&lt;body&gt;
  &lt;p&gt;&lt;strong&gt;count: 8&lt;/strong&gt;&lt;/p&gt;
  &lt;form name="todo" action="/show" method="POST"&gt;
  &lt;table border="1"&gt;
    &lt;tr&gt;
      &lt;th colspan="6"&gt;Active&lt;/th&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;th&gt;Select&lt;/th&gt;
      &lt;th&gt;Number&lt;/th&gt;
      &lt;th&gt;Creator&lt;/th&gt;
      &lt;th&gt;Created&lt;/th&gt;
      &lt;th&gt;Owner&lt;/th&gt;
      &lt;th&gt;Task&lt;/th&gt;
    &lt;/tr&gt;
    
    &lt;tr&gt;
      &lt;th colspan="6"&gt;Completed&lt;/th&gt;
    &lt;/tr&gt;
  &lt;p&gt;&lt;input type="submit" value="make active" /&gt;&lt;/p&gt;
  &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
I run the application:
<pre>$ python show.py
 * Running on http://127.0.0.1:5000/
 * Restarting with reloader...</pre>
and then point my browser at <code>http://127.0.0.1:5000/show/</code> (note the trailing slash).  As expected, Firebug tells me there has been one GET request, with no parameters.

I then tick off the first of the checkboxes and click "Submit".  According to Firebug, this causes a POST with "item=0" as the submitted data (good), which immediately redirects (code 301) to a GET to the same URL, but <em>without</em> any of the posted data.  Now, according to the section on "Unique URLs / Redirection Behaviour" in the <a href="http://flask.pocoo.org/docs/quickstart/#routing">Flask documentation</a>, if the URL specified in <code>app.route</code> has a trailing '/', then accessing the URL <em>without</em> the trailing slash automatically redirects to the URL <em>with</em> the trailing slash.  But I'm submitting a URL <em>with</em> a trailing slash, so there shouldn't be a redirect, and even if there is, why is the posted data being thrown away?

I'm clearly doing something wrong, and if it wasn't a warm Saturday afternoon, I'd probably have figured it out by now.  (But please don't let that stop you from sending me tips :-).  What I'd really like to know, though, is how the hell to explain whatever is going on to someone who's new to web programming.  I've tried teaching raw CGI programming to grad students in science and engineering&mdash;it usually fails because there are too many low-level details to master.  I'd hoped that high-level frameworks like Flask and web2py would make this stuff more accessible, but the <a href="http://www.joelonsoftware.com/articles/LeakyAbstractions.html">law of leaky abstractions</a> may put them out of practical reach as well: if things that look like they ought to work don't, and there's no easy way for someone who is just learning this stuff to debug it, we're dead in the water.

                


              </div>
            </div>
            <div class="pagination">
              
              <a class="btn btn-default" href="/2011/05/23/the-architecture-of-open-source-applications-is-now-available.html" class="next">Newer</a>
              
              
              <a class="btn btn-default" href="/2011/05/20/how-do-actual-software-engineers-perceive-software-engineering-research.html" class="previous">Older</a>
              
            </div>
            
            
            <div class="well">
              
              <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
              </div>
              
            </div>
            
            
          </div>
        </div>
      </div>
    </div>
    
  <script type="text/javascript">
    var disqus_shortname = 'thirdbit';

    var disqus_config = function () {
        this.page.identifier = '2011-05-21-why-does-flask-lose-my-post-data-when-it-redirects-html';
    };

   (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


    <div class="container-fluid">
  <div class="row-fluid">
    <div class="span12 footer navbar-inverse navbar-fixed-bottom">
      <br/>
      <p class="copyright">
        &copy; 2018 Greg Wilson.
        All content made available under the <a href="/license/">Creative Commons - Attribution License</a>.
      </p>
    </div>
  </div>
</div>


  <script type="text/javascript">
    var disqus_shortname = 'thirdbit';

    var disqus_config = function () {
        this.page.identifier = '2011-05-21-why-does-flask-lose-my-post-data-when-it-redirects-html';
    };

   (function () {
     var s = document.createElement('script'); s.async = true;
     s.type = 'text/javascript';
     s.src = '//' + disqus_shortname + '.disqus.com/count.js';
     (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
   }());
 </script>



  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1301159-1', 'auto');
    ga('send', 'pageview');
  </script>



</body>
</html>

  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/theme.js"></script>
<link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/css/theme.css" rel="stylesheet" type="text/css">
<link href="/css/syntax.css" rel="stylesheet" type="text/css">



    <title>Third Bit: DrProject Internals: Subversion</title>
  </head>
  <body>
    <div class="container-fluid">
  <div class="row-fluid">
    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Third Bit</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class="active visible-xs-block"><a href="/links/">Links</a></li>
          <li class="active"><a href="/about/">About</a></li>
          <li class="active"><a href="/talks/">Talks</a></li>
          <li class="active"><a href="/ideas/">Ideas</a></li>
          <li class="active"><a href="/reading/">Reading</a></li>
          <li class="active"><a href="/archive/">Archive</a></li>
          <li class="active"><a href="/teaching/"><em>How to Teach</em></a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li class="active"><a href="http://appear.in/gvwilson"><img src="/files/appear.in.svg" class="navbar-icon" /></a></li>
          <li class="active"><a href="https://github.com/gvwilson"><img src="/files/github.svg" class="navbar-icon" /></a></li>
          <li class="active"><a href="http://twitter.com/gvwilson"><img src="/files/twitter.svg" class="navbar-icon" /></a></li>
          <li class="active"><a href="/feed.xml"><img src="/files/rss.svg" class="navbar-icon" /></a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <div class="container container-left">
      <div class="row">
        <div class="col-md-3 hidden-xs">
          <div class="sidebar well">
  <h2>Links</h2>
<p><em><a href="http://software-carpentry.org">Software Carpentry</a></em></p>
<p><em><a href="http://aosabook.org">Architecture of Open Source Applications</a></em></p>
<p><em><a href="http://neverworkintheory.org">Never Work in Theory</a></em></p>
<p><em><a href="http://sensibleadventures.com">Sensible Adventures</a></em></p>
<p><a href="/cv/">CV</a></p>
<p><a href="/bib/">Bibliography</a></p>

  <h2>Favorites</h2>
  
  
  <p><a href="/2018/03/20/goodbye-jeff.html">Goodbye, Jeff</a></p>
  
  <p><a href="/2018/03/16/seven-ways.html">Seven Ways to Think Like a Programmer</a></p>
  
  <p><a href="/2018/03/13/base-case-for-empirical-software-engineering.html">A Base Case for Empirical Software Engineering Research</a></p>
  
  <p><a href="/2018/01/07/book-club.html">Book Club</a></p>
  
  <p><a href="/2017/12/21/talking-people-into-things.html">Ten Simple Rules for Talking People Into Things</a></p>
  
  <p><a href="/2017/11/05/for-everyone.html">Carpentry For Everyone</a></p>
  
  <p><a href="/2017/10/16/exercise-types.html">What Kinds of Exercises Do You Use to Teach Programming?</a></p>
  
  <p><a href="/2017/09/30/git-graphs-and-engineering.html">Git, Graphs, and Software Engineering</a></p>
  
  <p><a href="/2017/06/19/ten-rules-research-partner.html">Ten Simple Rules for Being a Good Research Partner</a></p>
  
  <p><a href="/2017/05/22/numerical-javascript.html">Numerical JavaScript</a></p>
  
  <p><a href="/2017/01/06/them-thats-got.html">Them That's Got</a></p>
  
  <p><a href="/2016/10/30/rules-for-teaching.html">Rules for Teaching</a></p>
  
  <p><a href="/2016/04/29/why-teachers-dont-collaborate.html">Why Teachers Don't Collaborate on Lesson Development</a></p>
  
  <p><a href="/2016/04/01/zen-and-the-art-of-assignment-operators.html">Zen and the Art of Assignment Operators</a></p>
  
  <p><a href="/2016/03/13/in-my-better-world.html">In My Better World</a></p>
  
  <p><a href="/2015/12/19/why-i-teach.html">Why I Teach (Revisited)</a></p>
  
  <p><a href="/2015/12/06/just-keep-swimming.html">Just Keep Swimming</a></p>
  
  <p><a href="/2015/11/29/exaptation.html">Exaptation and the Future of Software Engineering</a></p>
  
  <p><a href="/2015/11/09/daddy-why-dont-you-ever-laugh.html">Daddy, Why Don't You Ever Laugh?</a></p>
  
  <p><a href="/2015/09/22/dad.html">Goodbye, Dad</a></p>
  
  <p><a href="/2014/10/08/announcing-the-creation-of-the-software-carpentry-foundational.html">Announcing the Creation of the Software Carpentry Foundation</a></p>
  
  <p><a href="/2014/03/14/learning-at-scale.html">Is Learning at Scale Just Another Name for Ubiquitous Surveillance in the Classroom?</a></p>
  
  <p><a href="/2013/10/17/you-keep-using-that-word.html">You Keep Using That Word</a></p>
  
  <p><a href="/2013/02/11/correctness-isnt-compelling.html">Correctness Isn't Compelling</a></p>
  
  <p><a href="/2012/10/23/twenty-percent.html">Twenty Percent</a></p>
  
  <p><a href="/2012/06/29/those-who-ignore-history.html">That Seems Simple to Me</a></p>
  
  <p><a href="/2012/01/21/the-life-i-did-live-the-breath-i-breathed.html">We Have Nothing To Give Them</a></p>
  
</div>

        </div>
        <div class="col-md-9">
          <div class="article">
            <div class="well">
              <h1><a href="/2006/11/16/drproject-internals-subversion-part-1.html">Nov 16, 2006 - DrProject Internals: Subversion</a></h1>
              <div class="post-content">
                It's finally time to look at how <a href="http://www.drproject.org">DrProject</a> integrates with <a href="http://subversion.tigris.org">Subversion</a>.  "Integrates" is the key word here: whereas we (and <a href="http://trac.edgewall.org">Trac</a>'s designers before us) had a free hand with the ticketing system and wiki, <a href="http://subversion.tigris.org">Subversion</a> and other version control systems are complex enough that we have to base our design on what they can do, rather than what we might want.

Lucky for us, <a href="http://subversion.tigris.org">Subversion</a>'s designers had lots of experience with previous version control systems, and so were careful to provide tools that would make integration easy.  The best way to appreciate these tools is to compare the Bad Old Days (<a href="http://ximbiot.com/cvs/wiki">CVS</a> in the early 1990s) with our modern utopia.  The first time I had to mess around with it, the source code for <a href="http://ximbiot.com/cvs/wiki">CVS</a> was a tangled mess---so tangled that the best (possibly only) way to fetch a list of recent commit messages was to run the command in a sub-shell and parse its output.  Think for a moment about what that involves:
<ol>
	<li>My application formats a string containing a <a href="http://ximbiot.com/cvs/wiki">CVS</a> command.</li>
	<li>It passes that string to a shell running in a sub-process.</li>
	<li>That shell starts <em>another</em> process to execute the <code>cvs</code> program (unless the <code>PATH</code> variable has been mangled too badly by all this forking and exec'ing).</li>
	<li>The <code>cvs</code> program calls a bunch of C functions (some of which might actually starts sub-shells of their own, but that's another story) to extract information from the versioning files and metadata in the repository.</li>
	<li>My application reads that command's output as a list of strings and runs it through a handwritten parser that (hopefully) extracts dates, user IDs, and commit messages.</li>
</ol>
<a href="http://subversion.tigris.org">Subversion</a>'s design makes the first three steps are unnecessary.  It has a well-defined C API [1], which provides functions for doing (almost) all user-level operations.  Command-line programs like <code>svn</code> and <code>svnadmin</code> call these functions, but <a href="http://subversion.tigris.org">Subversion</a> also provides adapter libraries to make them available to Python, Java, and other languages.  As a result, programmers don't have to fork sub-processes, or parse strings; they can instead call a function, and get a data structure as a result.

All right: what information do project members actually want about their project's repository and its contents?  "What's there?"  (i.e., a listing of available files) is pretty obvious, along with what's in particular files, what used to be in them, and a list of change sets. If we're showing what used to be in files, we ought to show the differences too; and if we're showing change sets, we ought to provide a multi-file view of the overall differences.

Hm... What about access control?  How are we going to ensure that only people who are members of a project [2] can view the contents of the project's repository?  And what exactly do we mean by "the project's repository", anyway?  Is there going to be one repository for each of the projects <a href="http://www.drproject.org">DrProject</a> is managing, or would it be simpler and/or safer to partition one big repository into project-sized chunks?

<a href="http://subversion.tigris.org">Subversion</a> supports the latter: you can create an access file that gives particular users read and/or write permission for sub-directories within a repository. However, this is what Joel Spolsky famously called a <a href="http://www.joelonsoftware.com/articles/LeakyAbstractions.html">leaky abstraction</a>.  To see why, consider a situation in which Olga can read and write both the <code>red</code> and <code>green</code> directories in a repository, but Maxim can only read and write the <code>green</code> directory.  If Olga commits changes to updates <code>red/reddish.java</code> and <code>green/greenish.java</code> in a single operation, what should we show Maxim when he asks to view the change set?  We can hide the contents of, and changes to, the file he's not allowed to view, but he'll still be able to read Olga's commit message, which may (if Olga is conscientious) tell him a lot about what's going on in parts of the world he's not supposed to know anything about.

We therefore decided to use one repository per project.  Each of these repositories has its own access file; when users are added to or removed from the project, <a href="http://www.drproject.org">DrProject</a> modifies the access file appropriately [3].  This means that even if people bypass <a href="http://www.drproject.org">DrProject</a>, and try access repositories using Eclipse, command-line programs, and other clients, their access rights will always be what we want them to be.

One thing <a href="http://www.drproject.org">DrProject</a> does <em>not</em> provide is a way for users to modify the repository over the web.  In particular, users cannot edit or commit files through their browser.  We left this out for several reasons:
<ol>
	<li>It opens up a channel for attack: if the <a href="http://www.drproject.org">DrProject</a> CGI is able to modify the repository, then anyone who subverts the CGI can do a lot of damage to the project's core resource.</li>
	<li>We didn't believe anyone would ever actually do any significant code editing through an HTML text editing box.  (This may change in future, as rich editing controls become common; even today, it'd be nice to be able to add comments to commits after the fact.)</li>
	<li>Implementing it---in particular, implementing conflict resolution---would have at least tripled the complexity of this part of <a href="http://www.drproject.org">DrProject</a>.</li>
	<li>Nobody else's system has it, so we figured there couldn't be a crying need ;-)</li>
</ol>
It turns out that accessing a repository via the <a href="http://subversion.tigris.org">Subversion</a> API is a lot slower than querying a PostgreSQL database.  To keep things zippy, <a href="http://www.drproject.org">DrProject</a> caches the information it gets about the repository in the database, so that future lookups will be faster.  This information is WORM (write-once, read-many): once it's in the database, it stays there forever, and is never changed (except in those very rare cases when someone actually does edit a commit log message after the fact outside <a href="http://www.drproject.org">DrProject</a>, in which case the database information is resynchronized).

This isn't as big a disk hog as you might think, since most of what's in a repository is never viewed over the web.  However, we are a little worried about what might happen if we provide a web services API, so that people can write scripts to pull data out of <a href="http://www.drproject.org">DrProject</a>.  While a human being might not click on dozens of links to pull up all the files, revisions, change sets, and differences in a project, a script very easily could.  We'll see...

So how well is it working?  Pretty well, although students don't seem to use <a href="http://www.drproject.org">DrProject</a>'s <a href="http://subversion.tigris.org">Subversion</a> browser very much. One reason might be that they don't need it---in small projects, done by small teams, on short timescales, the history of a project isn't that important.  Another reason may be that desktop tools (command-line programs and Eclipse plugins) give them a richer experience.  Still, it does seem to be running smoothly, and the wiki formatting of commit messages, which automatically creates links to tickets, is something I personally rely on a fair bit.

<hr />[1] Yes, <a href="http://subversion.tigris.org">Subversion</a> is written in C, for both execution speed and portability.  The last may seem like an oxymoron, given the bajillions of <code>#ifdef</code>s programmers have to use to actually <em>make</em> their C portable, but these have the advantage of being well understood.  Getting C++ or Java to work on multiple platforms is actually no easier.[2] More specifically, have a <a href="http://pyre.third-bit.com/blog/archives/696.html">role</a> with respect to that project that includes the capability to view the contents of the repository.

[3] This is only true if administrators use the functions in <a href="http://www.drproject.org">DrProject</a> to edit user permissions.  If someone edits the underlying database directly via SQL, it obviously won't have the desired side effect of updating the <a href="http://subversion.tigris.org">Subversion</a> access file.

                


              </div>
            </div>
            <div class="pagination">
              
              <a class="btn btn-default" href="/2006/11/19/drproject-internals-testing.html" class="next">Newer</a>
              
              
              <a class="btn btn-default" href="/2006/11/13/tucows-on-spam-on-cbc-on-tonight.html" class="previous">Older</a>
              
            </div>
            
            
            <div class="well">
              
              <div id="disqus_thread">
                <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
              </div>
              
            </div>
            
            
          </div>
        </div>
      </div>
    </div>
    
  <script type="text/javascript">
    var disqus_shortname = 'thirdbit';

    var disqus_config = function () {
        this.page.identifier = '2006-11-16-drproject-internals-subversion-part-1-html';
    };

   (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


    <div class="container-fluid">
  <div class="row-fluid">
    <div class="span12 footer navbar-inverse navbar-fixed-bottom">
      <br/>
      <p class="copyright">
        &copy; 2018 Greg Wilson.
        All content made available under the <a href="/license/">Creative Commons - Attribution License</a>.
      </p>
    </div>
  </div>
</div>


  <script type="text/javascript">
    var disqus_shortname = 'thirdbit';

    var disqus_config = function () {
        this.page.identifier = '2006-11-16-drproject-internals-subversion-part-1-html';
    };

   (function () {
     var s = document.createElement('script'); s.async = true;
     s.type = 'text/javascript';
     s.src = '//' + disqus_shortname + '.disqus.com/count.js';
     (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
   }());
 </script>



  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1301159-1', 'auto');
    ga('send', 'pageview');
  </script>



</body>
</html>

  </body>
</html>
